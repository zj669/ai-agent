{
  "id": "snapshot_1768118084390_xokcgqmm2",
  "approvalId": "approval_1768118084358_9lp5pc0ts",
  "approvalTitle": "Agent Management Requirements Spec",
  "version": 1,
  "timestamp": "2026-01-11T07:54:44.390Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# 需求文档 - Agent 管理模块\r\n\r\n## 简介\r\n\r\nAgent 管理模块（Agent Management）旨在为用户提供创建、配置、发布和管理 AI Agent 的全生命周期管理能力。通过可视化界面定义工作流图（DAG），用户可以灵活构建复杂的 AI 应用。\r\n\r\n## 与产品愿景的一致性\r\n\r\n本项目致力于构建一个强大的 AI 智能代理平台。Agent 管理模块作为支撑域的核心部分，直接赋能用户创建个性化的智能体，是平台核心价值\"工作流编排\"的配置入口，对提升平台易用性和扩展性至关重要。\r\n\r\n## 需求详情\r\n\r\n### 需求 1：查询 Agent 列表\r\n\r\n**用户故事：** 作为用户，我希望查看我自己创建的所有 Agent 列表，以便于管理和选择需要编辑或使用的 Agent。\r\n\r\n#### 验收标准\r\n\r\n1. **WHEN** 用户请求查询 Agent 列表 **THEN** 系统应返回当前用户拥有的所有 Agent。\r\n2. **IF** 用户没有创建任何 Agent **THEN** 系统应返回空列表。\r\n3. **WHEN** 返回列表时 **THEN** 应按更新时间倒序排列。\r\n4. **WHEN** 返回列表包含字段 **THEN** 应包括：ID、名称、描述、状态（草稿/已发布/已停用）、创建时间、更新时间。\r\n\r\n### 需求 2：查询 Agent 详情\r\n\r\n**用户故事：** 作为用户，我希望查看指定 Agent 的详细配置信息，包括完整的工作流图定义，以便于继续编辑或通过详情了解 Agent 功能。\r\n\r\n#### 验收标准\r\n\r\n1. **WHEN** 用户请求指定 ID 的 Agent 详情 **THEN** 系统应返回该 Agent 的基本信息及完整的 graphJson。\r\n2. **IF** 请求的 Agent 不属于当前用户 **THEN** 系统应拒绝访问并返回无权限错误。\r\n3. **WHEN** 返回详情时 **THEN** graphJson 应包含完整的节点（nodes）和边（edges）定义。\r\n\r\n### 需求 3：保存 Agent (创建/更新)\r\n\r\n**用户故事：** 作为用户，我希望创建新的 Agent 或更新现有 Agent 的配置（包括名称、描述、工作流图），以便于保存我的设计工作。\r\n\r\n#### 验收标准\r\n\r\n1. **WHEN** 用户提交保存请求且 ID 为空 **THEN** 系统应创建新 Agent，状态默认为\"草稿\"。\r\n2. **WHEN** 用户提交保存请求且 ID 不为空 **THEN** 系统应更新对应 Agent 的信息。\r\n3. **IF** 更新时 ID 对应的 Agent 不属于当前用户 **THEN** 系统应拒绝操作。\r\n4. **WHEN** 保存 graphJson 时 **THEN** 系统应进行基本的 JSON 格式校验。\r\n\r\n### 需求 4：删除 Agent\r\n\r\n**用户故事：** 作为用户，我希望删除不再需要的 Agent，以便于清理我的工作区。\r\n\r\n#### 验收标准\r\n\r\n1. **WHEN** 用户请求删除指定 ID 的 Agent **THEN** 系统应物理删除该 Agent 记录。\r\n2. **IF** 请求删除的 Agent 不属于当前用户 **THEN** 系统应拒绝操作。\r\n3. **WHEN** 删除 Agent 后 **THEN** 相关的历史对话记录应保留（不随 Agent 删除而物理删除，或按需清理，当前需求为保留）。\r\n\r\n### 需求 5：发布 Agent\r\n\r\n**用户故事：** 作为用户，我希望能将设计好的 Agent 发布为可执行版本，以便于在对话中使用它。\r\n\r\n#### 验收标准\r\n\r\n1. **WHEN** 用户请求发布指定 Agent **THEN** 系统应将当前草稿状态的 graphJson 快照保存为不可变的 AgentVersion。\r\n2. **IF** Agent 当前状态不是\"草稿\" **THEN** 系统应允许发布（更新版本）或根据具体业务规则处理（需求指只有草稿可发布，需确认是否支持从已发布更新版本，通常支持多次发布生成新版本）。*注：根据当前需求文档，只有草稿状态可发布。*\r\n3. **WHEN** 发布成功后 **THEN** Agent 状态应更新为\"已发布\"，并生成新的 version 记录。\r\n4. **WHEN** 发布前 **THEN** 系统应校验 graphJson 的有效性（如 DAG 结构完整性）。\r\n\r\n## 非功能需求\r\n\r\n### 代码架构与模块化\r\n- **单一职责原则**：Agent 模块应独立于工作流执行模块，通过接口交互。\r\n- **模块化设计**：Agent 的领域实体（Aggregate Root）应封装核心业务逻辑。\r\n- **依赖管理**：Domain 层不依赖 Infrastructure 层。\r\n\r\n### 性能\r\n- **响应时间**：列表查询 < 100ms，详情查询 < 50ms。\r\n\r\n### 安全性\r\n- **鉴权**：所有操作必须校验用户身份，确保只能操作属于自己的数据（水平越权防护）。\r\n\r\n### 可靠性\r\n- **数据一致性**：发布操作应保证 Version 表插入和 Agent 表更新的原子性。\r\n\r\n### 易用性\r\n- **可视化支持**：GraphJson 结构应能够支持前端 DAG 图的渲染和编辑。\r\n",
  "fileStats": {
    "size": 4616,
    "lines": 84,
    "lastModified": "2026-01-11T07:54:42.399Z"
  },
  "comments": []
}