{
  "id": "snapshot_1768119080149_zlxstp0z8",
  "approvalId": "approval_1768119080133_fzyo6ktpm",
  "approvalTitle": "Agent Management Tasks Spec",
  "version": 1,
  "timestamp": "2026-01-11T08:11:20.149Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\r\n\r\n- [ ] 1. Implement Domain Layer Entities\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/agent/entity/Agent.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/agent/entity/AgentVersion.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/agent/valobj/AgentStatus.java\r\n  - Define `Agent` aggregate root with fields: `id`, `userId`, `name`, `description`, `graphJson`, `status`, `publishedVersionId`, `version`, `createTime`, `updateTime`\r\n  - Implement behaviors: `publish(validator)`, `updateConfig(...)`, `rollbackTo(...)`, `clone(...)` using optimistic locking\r\n  - Define `AgentVersion` entity and `AgentStatus` enum\r\n  - Purpose: Establish core business logic and state consistency\r\n  - _Requirements: 2.1, 2.2 (#5, #6, #8)_\r\n  - _Prompt: Role: Java Backend Developer specializing in DDD | Task: Implement Agent aggregate root and related entities enforcing documented business rules including optimistic locking and version control | Restrictions: Use JPA/MyBatis annotations as needed, ensure encapsulation of domain logic, strictly follow the design doc | Success: Entities contain all required fields and methods, logic for publish/rollback/clone is implemented correctly_\r\n\r\n- [ ] 2. Implement Domain Services and Repository Interface\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/agent/service/GraphValidator.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/agent/repository/AgentRepository.java\r\n  - Implement `GraphValidator` for pure internal structural validation (Schema, Cycles, Connectivity)\r\n  - Define `AgentRepository` interface separating Command (save) and Query (findSummary) operations\r\n  - Purpose: Define data access contract and domain validation rules\r\n  - _Requirements: 2.1, 2.2 (#6)_\r\n  - _Prompt: Role: Java Architect | Task: Create domain service for DAG validation and repository interfaces following CQRS principles | Restrictions: GraphValidator must be pure logic without DB dependencies, Repository must separate lightweight summary queries from full entity loading | Success: Validator correctly identifies invalid graphs, Repository interface covers all CRUD and versioning needs_\r\n\r\n- [ ] 3. Implement Infrastructure Persistence Layer\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/agent/po/AgentPO.java\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/agent/po/AgentVersionPO.java\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/agent/mapper/AgentMapper.java\r\n  - File: ai-agent-infrastructure/src/main/resources/mapper/agent/AgentMapper.xml\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/agent/repository/AgentRepositoryImpl.java\r\n  - Implement MyBatis POs, Mappers, and XMLs for `agent_info` and `agent_version` tables\r\n  - Implement `AgentRepositoryImpl` to map between POs and Domain Entities\r\n  - Purpose: Provide persistent storage implementation\r\n  - _Requirements: 2.1 (#1, #2, #3)_\r\n  - _Prompt: Role: Backend Developer with MyBatis expertise | Task: Implement infrastructure layer including POs, Mappers, and RepositoryImpl | Restrictions: Ensure correct mapping between heavy JSON fields and POJOs, handle optimistic locking in SQL updates | Success: Data is correctly saved/retrieved from MySQL, optimistic locking exceptions are thrown appropriately_\r\n\r\n- [ ] 4. Implement Application Layer Services\r\n  - File: ai-agent-application/src/main/java/com/zj/aiagent/application/agent/service/AgentApplicationService.java\r\n  - Implement `createAgent`, `updateAgent`, `publishAgent`, `copyAgent`, `rollbackAgent`, `debugAgent`, `getAgentDetail`, `getUserAgentList`\r\n  - Orchestrate domain objects and repositories, handle transactions (`@Transactional`)\r\n  - Implement IDOR protection (check `isOwnedBy`)\r\n  - Purpose: Coordinate business use cases and security checks\r\n  - _Requirements: 2.1, 2.2, 2.3 (#1-#9)_\r\n  - _Prompt: Role: Senior Java Developer | Task: Implement AgentApplicationService orchestrating all use cases | Restrictions: Must explicitly enforce ownership checks (IDOR protection) as the first step in every method, handle transactions correctly | Success: Service methods implement full logic for Create/Update/Publish/Clone/Rollback/Debug, security checks are robust_\r\n\r\n- [ ] 5. Implement Interface Layer (DTOs & Controller)\r\n  - File: ai-agent-interfaces/src/main/java/com/zj/aiagent/interfaces/web/agent/dto/AgentDTOs.java\r\n  - File: ai-agent-interfaces/src/main/java/com/zj/aiagent/interfaces/web/agent/AgentController.java\r\n  - Define DTOs: `AgentSaveReqDTO`, `AgentListRespDTO`, `AgentDetailRespDTO`\r\n  - Implement Controller endpoints mapping to ApplicationService\r\n  - Implement SSE endpoint for `debugAgent`\r\n  - Purpose: Expose functionality via REST/SSE APIs\r\n  - _Requirements: 2.1, 2.2, 2.3_\r\n  - _Prompt: Role: API Developer | Task: Implement AgentController and DTOs following REST best practices and SSE for debug | Restrictions: Ensure strict separation of read/write models, validate inputs, properly map debugInfo in SSE events | Success: API endpoints match design specs, DTOs are clean, Debug endpoint streams data correctly_\r\n\r\n- [ ] 6. Verification & Manual Testing\r\n  - Verify all endpoints using manual tests\r\n  - Test Optimistic Locking (Scenario: Concurrent updates)\r\n  - Test Rollback (Scenario: Publish -> V2 -> Rollback V1)\r\n  - Test Debug Mode (Scenario: Verify debugInfo in SSE stream)\r\n  - Purpose: Ensure feature works as expected before handover\r\n  - _Requirements: All_\r\n  - _Prompt: Role: QA Engineer | Task: Perform manual verification of implemented features | Restrictions: Focus on edge cases like concurrency and invalid graph structures | Success: All acceptance criteria from requirements.md are met_\r\n",
  "fileStats": {
    "size": 5843,
    "lines": 62,
    "lastModified": "2026-01-11T08:11:18.134Z"
  },
  "comments": []
}