{
  "id": "snapshot_1768111224439_pgisajp88",
  "approvalId": "approval_1768111224426_41ddt5eue",
  "approvalTitle": "User Authentication Tasks",
  "version": 1,
  "timestamp": "2026-01-11T06:00:24.439Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document\r\n\r\n- [ ] 1. Domain Layer - Core Aggregates and Value Objects\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/user/entity/User.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/user/valobj/Email.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/user/valobj/Credential.java\r\n  - Implement the `User` aggregate root with methods for password verification and profile updates.\r\n  - Implement `Email` value object with format validation.\r\n  - Implement `Credential` value object with BCrypt logic.\r\n  - _Leverage: DDD patterns, Lombok_\r\n  - _Requirements: 4.1, 4.2_\r\n  - _Prompt: Role: Java Backend Developer | Task: Implement Domain Layer entities for User Authentication including User aggregate, Email value object, and Credential value object following DDD principles | Restrictions: Use standard Java validation, ensure domain logic is encapsulated | Success: Entities are correctly defined with behavior methods_\r\n\r\n- [ ] 2. Domain Layer - Rate Limiting Strategy\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/auth/service/ratelimit/RateLimiter.java\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/auth/service/ratelimit/RateLimiterFactory.java\r\n  - Define `RateLimiter` interface.\r\n  - Implement `RateLimiterFactory` for creating rate limiter instances.\r\n  - _Requirements: Design-RateLimit_\r\n  - _Prompt: Role: Java Architect | Task: Implement Strategy and Factory pattern for Rate Limiting in Domain Layer | Restrictions: Define clear interface, extensible factory | Success: Interface and Factory allow for future expansion_\r\n\r\n- [ ] 3. Infrastructure Layer - Rate Limiter Implementation\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/auth/redis/RedisSlidingWindowRateLimiter.java\r\n  - Implement `SlidingWindowRateLimiter` using Redis (Template/Lua).\r\n  - _Leverage: StringRedisTemplate_\r\n  - _Requirements: Design-RateLimit_\r\n  - _Prompt: Role: Backend Developer | Task: Implement SlidingWindowRateLimiter using Redis | Restrictions: Ensure atomicity using Lua scripts or Redis transactions | Success: Rate limiter correctly counts and expires windows_\r\n\r\n- [ ] 4. Infrastructure Layer - Repository and Ports\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/user/mapper/UserMapper.java\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/user/repository/UserRepositoryImpl.java\r\n  - File: ai-agent-infrastructure/src/main/java/com/zj/aiagent/infrastructure/email/EmailServiceImpl.java\r\n  - Implement `UserRepository` using MyBatis-Plus.\r\n  - Implement `EmailService` for sending verification codes.\r\n  - _Leverage: MyBatis-Plus, JavaMailSender_\r\n  - _Requirements: Infra-Repo, Infra-Email_\r\n  - _Prompt: Role: Java Developer | Task: Implement Infrastructure persistence and external services | Restrictions: Use MyBatis-Plus for DB, standard JavaMail for email | Success: Data persistence works, emails are sent_\r\n\r\n- [ ] 5. Domain Layer - Domain Services\r\n  - File: ai-agent-domain/src/main/java/com/zj/aiagent/domain/user/service/UserAuthenticationDomainService.java\r\n  - Implement core authentication flow: verify code -> check duplicate -> create user.\r\n  - _Requirements: Req-2, Req-3_\r\n  - _Prompt: Role: Java Domain Expert | Task: Implement UserAuthenticationDomainService orchestrating registration and login logic | Restrictions: Pure domain logic, no HTTP dependencies | Success: Business flows for reg/login are correct_\r\n\r\n- [ ] 6. Application Layer - Service Implementation\r\n  - File: ai-agent-application/src/main/java/com/zj/aiagent/application/user/UserApplicationService.java\r\n  - File: ai-agent-application/src/main/java/com/zj/aiagent/application/user/dto/* (DTO classes)\r\n  - Implement application service to coordinate Domain and Infrastructure.\r\n  - Handle DTO <-> Entity mapping.\r\n  - _Requirements: App-Service_\r\n  - _Prompt: Role: Java Application Developer | Task: Implement UserApplicationService and DTOs | Restrictions: Transactional boundaries, DTO mapping | Success: Service methods fulfill use cases_\r\n\r\n- [ ] 7. Interface Layer - REST Controller\r\n  - File: ai-agent-interfaces/src/main/java/com/zj/aiagent/interfaces/web/controller/client/UserController.java\r\n  - Implement standard REST endpoints defined in Design.\r\n  - Add Swagger/OpenAPI annotations.\r\n  - _Requirements: Interface-API_\r\n  - _Prompt: Role: API Developer | Task: Implement UserController with REST endpoints | Restrictions: Standard Spring MVC, validation, unified response | Success: All endpoints reachable and valid_\r\n\r\n- [ ] 8. Testing - Unit and Integration\r\n  - File: ai-agent-domain/src/test/java/com/zj/aiagent/domain/user/UserTest.java\r\n  - File: ai-agent-interfaces/src/test/java/com/zj/aiagent/interfaces/web/UserControllerTest.java\r\n  - Write unit tests for User aggregate behavior.\r\n  - Write integration tests for Controller endpoints.\r\n  - _Requirements: Test-Strategy_\r\n  - _Prompt: Role: Test Engineer | Task: Create comprehensive tests for User module | Restrictions: High coverage, mock external deps for unit tests | Success: Tests pass and cover critical paths_\r\n",
  "fileStats": {
    "size": 5180,
    "lines": 67,
    "lastModified": "2026-01-11T06:00:22.653Z"
  },
  "comments": []
}